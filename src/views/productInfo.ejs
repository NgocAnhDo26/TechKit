<!-- Breadcrumbs -->
<section id="breadcrumbs" class="py-6">
    <div class="container mx-auto px-4">
        <ol class="list-reset flex">
            <li>
                <a href="/" class="font-semibold hover:text-primary"
                    >Trang chủ</a
                >
            </li>
            <li><span class="mx-2">&gt;</span></li>
            <li>
                <a
                    href="/shop/<%= product.category.name.toLowerCase() %>"
                    class="font-semibold hover:text-primary"
                    ><%= product.category.name %></a
                >
            </li>
            <li><span class="mx-2">&gt;</span></li>
            <li><%= product.name %></li>
        </ol>
    </div>
</section>

<!-- Product info -->
<section id="product-info" class="mx-5 md:mx-20 rounded-lg py-5 bg-white">
    <div class="container mx-auto">
        <div class="py-6">
            <div class="flex flex-col lg:flex-row gap-10">
                <!-- Image Section -->
                <div class="w-full lg:w-1/2">
                    <div class="flex flex-col gap-4">
                        <!-- Big Image -->
                        <div id="main-image-container">
                            <img
                                id="main-image"
                                class="h-auto w-full max-w-full rounded-lg object-cover object-center md:h-[480px]"
                                src="<%= product.product_image[0].url %>"
                                alt="Main Product Image"
                            />
                        </div>
                        <!-- Small Images -->
                        <!-- Swiper Slider -->
                    </div>
                </div>
                <!-- Product Details Section -->
                <div class="w-full lg:w-1/2 flex flex-col justify-between">
                    <div class="pb-8 border-b border-gray-line">
                        <h1 class="text-3xl font-bold mb-4">
                            <%= product.name %>
                        </h1>
                        <div class="flex items-center mb-4">
                            <span class="text-yellow-400">★★★★★</span>
                            <span class="ml-2">(0 Reviews)</span>
                        </div>
                        <div class="mb-4 pb-4 border-b">
                            <span>Thương hiệu: </span>
                            <a href="" class="text-primary"
                                ><%= product.brand %></a
                            >
                            <span class="mx-2">|</span>
                            <span>Loại: </span>
                            <a href="" class="text-primary"
                                ><%= product.category.name %></a
                            >
                        </div>
                        <div class="mb-4 pb-4 border-b border-gray-line">
                            <p class="mb-2">✔ Bảo hành chính hãng 24 tháng.</p>
                            <p class="mb-2">✔ Hỗ trợ đổi mới trong 7 ngày.</p>
                            <p class="mb-2">✔ Miễn phí giao hàng toàn quốc.</p>
                        </div>
                        <div class="text-4xl font-semibold mb-8">
                            <% if (product.price_sale) { %>
                            <span class="text-primary">
                                <%= product.price_sale.toLocaleString() %>₫
                            </span>
                            <s
                                class="text-2xl text-gray-400 font-light stroke-gray-line ml-3 text-gray-txt"
                            >
                                <%= product.price.toLocaleString() %>₫
                            </s>
                            <span class="text-2xl ml-5 text-primary"
                                >-<%= (100 - Math.round((product.price_sale /
                                product.price) * 100)) %>%</span
                            >
                            <% } else { %>
                            <span class="text-primary">
                                <%= product.price.toLocaleString() %>₫
                            </span>
                            <% } %>
                        </div>
                        <div class="flex items-center mb-8 border-2 w-min">
                            <button
                                id="decrease"
                                class="text-primary text-xl font-semibold w-10 h-10 flex items-center justify-center hover:bg-primary hover:text-white"
                                disabled
                            >
                                -
                            </button>
                            <input
                                id="quantity"
                                type="text"
                                value="1"
                                class="w-auto min-w-10 max-w-10 py-2 text-center justify-center self-center"
                                readonly
                            />
                            <button
                                id="increase"
                                class="text-primary text-xl w-10 h-10 items-center justify-center hover:bg-primary hover:text-white"
                            >
                                +
                            </button>
                        </div>
                        <button
                            id="add-to-cart"
                            class="bg-primary border border-transparent hover:bg-transparent hover:border-primary text-white hover:text-primary py-2 px-4 rounded-md w-full"
                        >
                            <div class="font-bold mt-1">THÊM VÀO GIỎ</div>
                            <div class="mb-1">
                                Giao tận nơi Hoặc Nhận tại cửa hàng
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Product tabs description -->
<section>
    <div class="container mx-auto">
        <div class="pb-10">
            <div class="mt-10">
                <div class="flex space-x-4" role="tablist">
                    <button
                        id="description-tab"
                        role="tab"
                        aria-controls="description-content"
                        aria-selected="true"
                        class="tab active"
                    >
                        Mô tả
                    </button>
                    <button
                        id="specs-tab"
                        role="tab"
                        aria-controls="specs-content"
                        aria-selected="false"
                        class="tab"
                    >
                        Thông số chi tiết
                    </button>
                    <button
                        id="reviews-tab"
                        role="tab"
                        aria-controls="reviews-content"
                        aria-selected="false"
                        class="tab"
                    >
                        Đánh giá
                    </button>
                </div>
                <div class="mt-8">
                    <div
                        id="description-content"
                        role="tabpanel"
                        aria-labelledby="description-tab"
                        class="tab-content"
                    >
                        <div class="flex flex-col lg:flex-row lg:space-x-8">
                            <div class="w-full">
                                <% product.description.split(/[\r\n]+/).forEach(str => { %>
                                    <p class="mb-4"><%=str%></p>
                                <% }); %>
                            </div>
                        </div>
                    </div>

                    <div
                        id="specs-content"
                        role="tabpanel"
                        aria-labelledby="specs-tab"
                        class="tab-content"
                    >
                        <div class="flex flex-col lg:flex-row lg:space-x-8">
                            <div class="w-full">
                                <ul>
                                    <li>
                                        <span class="font-bold">CPU: </span>
                                        <%= product.cpu %>
                                    </li>
                                    <li>
                                        <span class="font-bold"
                                            >Dung lượng: </span
                                        ><%= product.storage %>
                                    </li>
                                    <li>
                                        <span class="font-bold">RAM: </span>
                                        <%= product.ram %>
                                    </li>
                                    <li>
                                        <span class="font-bold"
                                            >Card đồ họa: </span>
                                            <%= product.graphic_card %>
                                    </li>
                                    <li>
                                        <span class="font-bold"
                                            >Kích thước màn hình: </span >
                                            <%= product.screen_size %>
                                        inch
                                    </li>
                                    <li>
                                        <span class="font-bold"
                                            >Độ phân giải: </span
                                        ><%= product.resolution %>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div
                        id="reviews-content"
                        role="tabpanel"
                        aria-labelledby="reviews-tab"
                        class="tab-content hidden"
                    >
                        <!-- Reviews List -->
                        <div class="space-y-6">
                            <div id="reviews-list">
                                <!-- Review 1 -->
                                <div class="py-4">
                                    <div class="flex items-center mb-2">
                                        <span
                                            class="text-lg font-semibold text-gray-700"
                                            >John Doe</span
                                        >
                                        <span class="ml-2 text-primary"
                                            >★★★★★</span
                                        >
                                    </div>
                                    <p>
                                        Great quality! Fits perfectly and the
                                        material feels premium. Highly recommend
                                        this t-shirt.
                                    </p>
                                </div>
                                <!-- Review 2 -->
                                <div class="border-t border-gray-line py-4">
                                    <div class="flex items-center mb-2">
                                        <span
                                            class="text-lg font-semibold text-gray-700"
                                            >Jane Smith</span
                                        >
                                        <span class="ml-2 text-primary"
                                            >★★★★☆</span
                                        >
                                    </div>
                                    <p>
                                        I love the design and the fabric is very
                                        comfortable. However, I wish it came in
                                        more colors.
                                    </p>
                                </div>
                                <!-- Review 3 -->
                                <div class="border-t border-gray-line py-4">
                                    <div class="flex items-center mb-2">
                                        <span
                                            class="text-lg font-semibold text-gray-700"
                                            >Alice Johnson</span
                                        >
                                        <span class="ml-2 text-primary"
                                            >★★★★★</span
                                        >
                                    </div>
                                    <p>
                                        Excellent t-shirt! The size is perfect
                                        and it looks great. Will definitely buy
                                        again.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Review Form -->
                        <div class="mt-8">
                            <h3 class="text-lg font-semibold mb-4">
                                Write a Review
                            </h3>
                            <form id="review-form" class="space-y-4">
                                <div
                                    class="space-y-4 md:flex md:space-x-4 md:space-y-0"
                                >
                                    <div class="md:flex-1">
                                        <label
                                            for="review-name"
                                            class="block text-sm font-medium text-gray-700"
                                            >Name</label
                                        >
                                        <input
                                            type="text"
                                            id="review-name"
                                            name="review-name"
                                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                                        />
                                    </div>
                                    <div class="md:flex-1">
                                        <label
                                            for="review-email"
                                            class="block text-sm font-medium text-gray-700"
                                            >Email</label
                                        >
                                        <input
                                            type="email"
                                            id="review-email"
                                            name="review-email"
                                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                                        />
                                    </div>
                                    <div class="md:flex-1">
                                        <label
                                            for="review-rating"
                                            class="block text-sm font-medium text-gray-700"
                                            >Rating</label
                                        >
                                        <select
                                            id="review-rating"
                                            name="review-rating"
                                            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                                        >
                                            <option value="5">★★★★★</option>
                                            <option value="4">★★★★☆</option>
                                            <option value="3">★★★☆☆</option>
                                            <option value="2">★★☆☆☆</option>
                                            <option value="1">★☆☆☆☆</option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label
                                        for="review-text"
                                        class="block text-sm font-medium text-gray-700"
                                        >Review</label
                                    >
                                    <textarea
                                        id="review-text"
                                        name="review-text"
                                        rows="4"
                                        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                                    ></textarea>
                                </div>
                                <div>
                                    <button
                                        type="submit"
                                        class="bg-primary hover:bg-transparent border border-transparent hover:border-primary text-white hover:text-primary font-semibold py-2 px-4 rounded-full focus:outline-none"
                                    >
                                        Submit Review
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    // Change tab content
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach((tab) => {
        tab.addEventListener('click', () => {
            tabs.forEach((item) => item.classList.remove('active'));
            tab.classList.add('active');

            const target = tab.getAttribute('aria-controls');
            tabContents.forEach((content) => {
                if (content.getAttribute('id') === target) {
                    content.classList.remove('hidden');
                } else {
                    content.classList.add('hidden');
                }
            });
        });
    });

    // Increase and decrease quantity
    const decrease = document.getElementById('decrease');
    const increase = document.getElementById('increase');
    const quantity = document.getElementById('quantity');

    decrease.addEventListener('click', () => {
        let value = parseInt(quantity.value);
        if (value > 1) {
            value--;
            quantity.value = value;
            if (value === 1) {
                decrease.disabled = true;
            }
        }
    });

    // Handle add to cart
    const addToCart = async (productId) => {
        try {
            const response = await fetch('/api/cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    productId: parseInt(productId),
                    quantity: parseInt(quantity.value),
                }),
            });

            if (response.ok) {
                const data = await response.json();
                if (data) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Thành công',
                        text: 'Sản phẩm đã được thêm vào giỏ hàng',
                        showConfirmButton: false,
                        timer: 2000,
                    });

                    await updateCartCount();
                }
            } else {
                const message = await response.text();
                Swal.fire({
                    icon: 'error',
                    title: 'Thất bại',
                    text: message,
                    showConfirmButton: false,
                    timer: 2000,
                });
            }
        } catch (error) {
            Swal.fire({
                icon: 'error',
                title: 'Thất bại',
                text: 'Đã xảy ra lỗi khi thêm sản phẩm vào giỏ hàng',
                showConfirmButton: false,
                timer: 2000,
            });
        }
    };

    // Add event listener to add to cart btn
    document.getElementById('add-to-cart').addEventListener('click', () => {
        addToCart('<%= product.id %>');
    });
</script>
